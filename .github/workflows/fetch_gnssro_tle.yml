name: GNSSRO TLE è‡ªåŠ¨ä¸‹è½½

on:
  schedule:
    - cron: "0 3 * * *"   # æ¯å¤©UTCæ—¶é—´2ç‚¹è¿è¡Œä¸€æ¬¡
  workflow_dispatch:      # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  fetch-gnssro-tle:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: æ‹‰å–ä»“åº“
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: è®¾ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: 3.14.0-beta.4

      - name: å®‰è£…ç³»ç»Ÿä¾èµ–
        run: |
          echo "å¼€å§‹å®‰è£…ç³»ç»Ÿä¾èµ–..."
          sudo apt-get update -qq
          sudo apt-get install -y --no-install-recommends \
            gcc \
            g++ 
          echo "ç³»ç»Ÿä¾èµ–å®‰è£…å®Œæˆ"

      - name: å®‰è£… Python ä¾èµ–
        run: |
          echo "å¼€å§‹å®‰è£… Python ä¾èµ–..."
          python -m pip install --upgrade pip
          pip install requests
          echo "Python ä¾èµ–å®‰è£…å®Œæˆ"

      - name: è¿è¡Œ fetch_gnssro_tle.py
        run: |
          echo "å¼€å§‹è¿è¡Œ fetch_gnssro_tle.py..."
          cd scripts
          python fetch_gnssro_tle.py

      - name: é…ç½® Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: æäº¤å¹¶æ¨é€æ›´æ–°
        run: |
          git add assets/traj/Rx-GNSSRO.tle
          if git diff --staged --quiet; then
            echo "æ²¡æœ‰æ–°çš„æ˜Ÿå†æ–‡ä»¶éœ€è¦æäº¤"
          else
            git commit -m "ğŸ¤– Auto update GNSSRO TLE $(date '+%Y-%m-%d %H:%M:%S UTC')"
            git push
          fi 
